generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Represents the Orthodontist who logs in and uses the application.
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  fullName  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  patients Patient[]
}

enum PatientStatus {
  ACTIVE
  PAUSED
  FINISHED
}

model Patient {
  id                 String        @id @default(cuid())
  rut                String
  fullName           String
  phone              String
  email              String
  treatmentStartDate DateTime
  changeFrequency    Int
  status             PatientStatus @default(ACTIVE)
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @updatedAt

  messageLogs        MessageLog[]

  // --- RELATIONSHIP TO USER (ORTHODONTIST) ---
  userId             String
  user               User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  // --- MULTI-TENANT UNIQUE CONSTRAINTS ---
  @@unique([userId, rut])
  @@unique([userId, phone])
  @@unique([userId, email])
}

model MessageLog {
  id             String   @id @default(cuid())
  sentAt         DateTime @default(now())
  status         String
  messageContent String

  patientId      String
  patient        Patient  @relation(fields: [patientId], references: [id], onDelete: Cascade)
}